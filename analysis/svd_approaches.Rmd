---
title: "Dimkid: Singular Value Decomposition (SVD)"
output:
  html_notebook:
    toc: true
    toc_float: true
    toc_depth: 3
---

```{r, include = F}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r setup, include = F}
library(tidyverse)
library(rms)
library(psych)
```

```{r data, include = F}
source("scripts/import_data.R")
```
```{r functions, include = F}
source("scripts/make_functions.R")
source("scripts/do_efa.R")
```

In this document, I explore 4 approaches to SVD with Dimkid data:

1. No mean-centering, characters as rows and capacities as columns
2. No mean-centering, capacities as rows and characters as columns
3. Mean-centering by capacity, characters as rows and capacities as columns (the classic approach)
4. Mean-centering by character, capacities as rows and characters as columns


# Approach #1

In Approach #1 we proceed without mean-centering, with characters as rows and capacities as columns.

## Raw data matrix visualizations {.tabset}

### Adults

In this study, 431 US adults rated 21 characters (between-subjects) on 40 capacities (within-subjects). (See Weisman, Dweck, & Markman, 2017, _PNAS_, Study 4.)

```{r, fig.width = 4, fig.asp = 0.67}
d_ad %>%
  gather(capacity, mean_rating, -character) %>%
  ggplot(aes(x = capacity, y = character, fill = mean_rating)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-3, 3),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: Adults",
       subtitle = "21 characters, 40 capacities",
       x = "Capacity",
       y = "Character",
       fill = "Mean rating")
```

### 7-9yo children

In this study, 123 7- to 9-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 4, fig.asp = 0.67}
d_79 %>%
  gather(capacity, mean_rating, -character) %>%
  ggplot(aes(x = capacity, y = character, fill = mean_rating)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(0, 1),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 7- to 9-year-old children",
       subtitle = "9 characters, 20 capacities",
       x = "Capacity",
       y = "Character",
       fill = "Mean rating")
```

### 4-6yo children

In this study, 124 4- to 6-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 4, fig.asp = 0.67}
d_46 %>%
  gather(capacity, mean_rating, -character) %>%
  ggplot(aes(x = capacity, y = character, fill = mean_rating)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(0, 1),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 4- to 6-year-old children",
       subtitle = "9 characters, 20 capacities",
       x = "Capacity",
       y = "Character",
       fill = "Mean rating")
```



## SVD {.tabset}

### Adults

```{r}
svd1_ad <- svd(d_ad %>% column_to_rownames("character"), 
               nrow(d_ad), nrow(d_ad))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd1_ad, transpose = FALSE, "adults") +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd1_ad, "adults", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd1_ad) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd1_ad, "adults", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd1_ad, "adults", efa_colors = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd1_ad, "adults", efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd1_ad, "adults", efa_colors = TRUE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd1_ad, "adults",  
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd1_ad, "adults",
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd1_ad, "adults", 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #1)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 7-9y

```{r}
svd1_79 <- svd(d_79 %>% column_to_rownames("character"), 
               nrow(d_79), nrow(d_79))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd1_79, transpose = FALSE, "children") +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd1_79, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd1_79) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd1_79, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd1_79, "children", efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd1_79, "children", efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd1_79, "children", efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd1_79, "children", 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd1_79, "children",
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd1_79, "children", 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #1)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-6y

```{r}
svd1_46 <- svd(d_46 %>% column_to_rownames("character"), 
               nrow(d_46), nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd1_46, transpose = FALSE, "children") +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd1_46, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd1_46) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd1_46, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd1_46, "children", efa_colors = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd1_46, "children", efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd1_46, "children", efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd1_46, "children", 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd1_46, "children", 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd1_46, "children",  
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #1)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-9y

```{r}
svd1_49 <- svd(d_79 %>%
                 mutate(character = paste(character, "79", sep = "_")) %>%
                 bind_rows(d_46 %>%
                             mutate(character = paste(character, "46", 
                                                      sep = "_"))) %>% 
                 column_to_rownames("character"), 
               nrow(d_79) + nrow(d_46), nrow(d_79) + nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd1_49, transpose = FALSE, "children_comb") +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd1_49, "children_comb", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd1_49) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd1_49, "children_comb", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd1_49, "children_comb", efa_colors = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd1_49, "children_comb", efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd1_49, "children_comb", efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd1_49, "children_comb", 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_U_fun_prop(svd1_49, "children_comb", 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_U_fun_prop(svd1_49, "children_comb",  
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #1)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))
```


# Approach #2

In Approach #2 we proceed without mean-centering, with capacities as rows and characters as columns.

## Raw data matrix visualizations {.tabset}

### Adults

In this study, 431 US adults rated 21 characters (between-subjects) on 40 capacities (within-subjects). (See Weisman, Dweck, & Markman, 2017, _PNAS_, Study 4.)

```{r, fig.width = 3, fig.asp = 1.79}
d_ad %>%
  gather(capacity, mean_rating, -character) %>%
  ggplot(aes(y = capacity, x = character, fill = mean_rating)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-3, 3),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: Adults",
       subtitle = "21 characters, 40 capacities",
       y = "Capacity",
       x = "Character",
       fill = "Mean rating")
```

### 7-9yo children

In this study, 123 7- to 9-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 3, fig.asp = 1.49}
d_79 %>%
  gather(capacity, mean_rating, -character) %>%
  ggplot(aes(y = capacity, x = character, fill = mean_rating)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(0, 1),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 7- to 9-year-old children",
       subtitle = "9 characters, 20 capacities",
       y = "Capacity",
       x = "Character",
       fill = "Mean rating")
```

### 4-6yo children

In this study, 124 4- to 6-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 3, fig.asp = 1.49}
d_46 %>%
  gather(capacity, mean_rating, -character) %>%
  ggplot(aes(y = capacity, x = character, fill = mean_rating)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(0, 1),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 4- to 6-year-old children",
       subtitle = "9 characters, 20 capacities",
       y = "Capacity",
       x = "Character",
       fill = "Mean rating")
```


## SVD {.tabset}

### Adults

```{r}
svd2_ad <- svd(d_ad %>% column_to_rownames("character") %>% t(), 
               nrow(d_ad), nrow(d_ad))
```

#### Reconstructed data

```{r, fig.width = 3, fig.asp = 1.49}
plot_reconstruct_fun(svd2_ad, "adults", TRUE) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_U_fun(svd2_ad, "adults", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd2_ad) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1}
plot_V_fun(svd2_ad, "adults", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd2_ad, "adults", transpose = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "V: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd2_ad, "adults", transpose = TRUE, 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "V: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd2_ad, "adults", transpose = TRUE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "V: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd2_ad, "adults", transpose = TRUE, efa_colors = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "U: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd2_ad, "adults", transpose = TRUE, efa_colors = TRUE, 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "U: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd2_ad, "adults", transpose = TRUE, efa_colors = TRUE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #2)",
       subtitle = "U: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 7-9y

```{r}
svd2_79 <- svd(d_79 %>% column_to_rownames("character") %>% t(), 
               nrow(d_79), nrow(d_79))
```

#### Reconstructed data

```{r, fig.width = 3, fig.asp = 1.49}
plot_reconstruct_fun(svd2_79, "children", TRUE) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_U_fun(svd2_79, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd2_79) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1}
plot_V_fun(svd2_79, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd2_79, "children", transpose = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "V: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd2_79, "children", transpose = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "V: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd2_79, "children", transpose = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "V: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd2_79, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "U: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd2_79, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "U: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd2_79, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #2)",
       subtitle = "U: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-6y

```{r}
svd2_46 <- svd(d_46 %>% column_to_rownames("character") %>% t(), 
               nrow(d_46), nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 3, fig.asp = 1.49}
plot_reconstruct_fun(svd2_46, "children", TRUE) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_U_fun(svd2_46, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd2_46) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1}
plot_V_fun(svd2_46, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd2_46, "children", transpose = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "V: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd2_46, "children", transpose = TRUE, 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "V: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd2_46, "children", transpose = TRUE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "V: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd2_46, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "U: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd2_46, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "U: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd2_46, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #2)",
       subtitle = "U: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-9y

```{r}
svd2_49 <- svd(d_79 %>%
                 mutate(character = paste(character, "79", sep = "_")) %>%
                 bind_rows(d_46 %>%
                             mutate(character = paste(character, "46", 
                                                      sep = "_"))) %>% 
                 column_to_rownames("character") %>%
                 t(), 
               nrow(d_79) + nrow(d_46), nrow(d_79) + nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd2_49, transpose = TRUE, "children_comb") +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd2_49, "children_comb", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd2_49) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd2_49, "children_comb", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd2_49, "children_comb", transpose = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_V_fun_item(svd2_49, "children_comb", transpose = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_V_fun_item(svd2_49, "children_comb", transpose = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd2_49, "children_comb", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd2_49, "children_comb", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd2_49, "children_comb", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #2)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


# Approach #3

In Approach #3 we mean-center by capacity, with characters as rows and capacities as columns.

## Raw data matrix visualizations {.tabset}

### Adults

In this study, 431 US adults rated 21 characters (between-subjects) on 40 capacities (within-subjects). (See Weisman, Dweck, & Markman, 2017, _PNAS_, Study 4.)

```{r, fig.width = 4, fig.asp = 0.67}
d_ad %>%
  mean_cent_fun(by = "capacity", age_group = "adults") %>%
  gather(capacity, mean_cent, -character) %>%
  ggplot(aes(x = capacity, y = character, fill = mean_cent)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-6, 6),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: Adults",
       subtitle = "21 characters, 40 capacities",
       x = "Capacity",
       y = "Character",
       fill = "Mean rating")
```

### 7-9yo children

In this study, 123 7- to 9-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 4, fig.asp = 0.67}
d_79 %>%
  mean_cent_fun(by = "capacity", age_group = "children") %>%
  gather(capacity, mean_cent, -character) %>%
  ggplot(aes(x = capacity, y = character, fill = mean_cent)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-2, 2),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 7- to 9-year-old children",
       subtitle = "9 characters, 20 capacities",
       x = "Capacity",
       y = "Character",
       fill = "Mean rating")
```

### 4-6yo children

In this study, 124 4- to 6-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 4, fig.asp = 0.67}
d_46 %>%
  mean_cent_fun(by = "capacity", age_group = "children") %>%
  gather(capacity, mean_cent, -character) %>%
  ggplot(aes(x = capacity, y = character, fill = mean_cent)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-2, 2),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 4- to 6-year-old children",
       subtitle = "9 characters, 20 capacities",
       x = "Capacity",
       y = "Character",
       fill = "Mean rating")
```


## SVD {.tabset}

### Adults

```{r}
svd3_ad <- svd(d_ad %>%
                 mean_cent_fun("capacity", age_group = "adults") %>%
                 column_to_rownames("character"),
               nrow(d_ad), nrow(d_ad))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd3_ad, transpose = FALSE, "adults") +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd3_ad, "adults", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd3_ad) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd3_ad, "adults", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd3_ad, "adults", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd3_ad, "adults", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd3_ad, "adults", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd3_ad, "adults", transpose = FALSE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd3_ad, "adults", transpose = FALSE, 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd3_ad, "adults", transpose = FALSE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #3)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 7-9y

```{r}
svd3_79 <- svd(d_79 %>%
                 mean_cent_fun("capacity", age_group = "children") %>%
                 column_to_rownames("character"),
               nrow(d_79), nrow(d_79))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd3_79, transpose = FALSE, "children") +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd3_79, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd3_79) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd3_79, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd3_79, "children", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd3_79, "children", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd3_79, "children", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd3_79, "children", transpose = FALSE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd3_79, "children", transpose = FALSE, 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd3_79, "children", transpose = FALSE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #3)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-6y

```{r}
svd3_46 <- svd(d_46 %>%
                 mean_cent_fun("capacity", age_group = "children") %>%
                 column_to_rownames("character"),
               nrow(d_46), nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd3_46, transpose = FALSE, "children") +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd3_46, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd3_46) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd3_46, "children", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd3_46, "children", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd3_46, "children", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd3_46, "children", transpose = FALSE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd3_46, "children", transpose = FALSE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd3_46, "children", transpose = FALSE, 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd3_46, "children", transpose = FALSE, 
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #3)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-9y

```{r}
svd3_49 <- svd(d_79 %>%
                 mutate(character = paste(character, "79", sep = "_")) %>%
                 bind_rows(d_46 %>%
                             mutate(character = paste(character, "46", 
                                                      sep = "_"))) %>% 
                 mean_cent_fun("capacity", age_group = "children") %>%
                 column_to_rownames("character"), 
               nrow(d_79) + nrow(d_46), nrow(d_79) + nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd3_49, transpose = FALSE, "children_comb") +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd3_49, "children_comb", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd3_49) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd3_49, "children_comb", transpose = FALSE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd3_49, "children_comb", efa_colors = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd3_49, "children_comb", efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd3_49, "children_comb", efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd3_49, "children_comb", 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_U_fun_prop(svd3_49, "children_comb", 
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_U_fun_prop(svd3_49, "children_comb",  
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #3)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))
```


# Approach #4

In Approach #4 we mean-center by character, with capacities as rows and characters as columns.

## Raw data matrix visualizations {.tabset}

### Adults

In this study, 431 US adults rated 21 characters (between-subjects) on 40 capacities (within-subjects). (See Weisman, Dweck, & Markman, 2017, _PNAS_, Study 4.)

```{r, fig.width = 3, fig.asp = 1.49}
d_ad %>%
  mean_cent_fun("character", age_group = "adults") %>%
  gather(character, mean_cent, -capacity) %>%
  mutate(character = factor(character, levels = character_names_ad)) %>%
  ggplot(aes(y = capacity, x = character, fill = mean_cent)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-3, 3),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: Adults",
       subtitle = "21 characters, 40 capacities",
       y = "Capacity",
       x = "Character",
       fill = "Mean rating")
```

### 7-9yo children

In this study, 123 7- to 9-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 3, fig.asp = 1.49}
d_79 %>%
  mean_cent_fun("character", age_group = "children") %>%
  gather(character, mean_cent, -capacity) %>%
  mutate(character = factor(character, levels = character_names_ch)) %>%
  ggplot(aes(y = capacity, x = character, fill = mean_cent)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-2, 2),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 7- to 9-year-old children",
       subtitle = "9 characters, 20 capacities",
       y = "Capacity",
       x = "Character",
       fill = "Mean rating")
```

### 4-6yo children

In this study, 124 4- to 6-year-old US children rated 9 characters (between-subjects) on 20 capacities (within subjects). (See Weisman, Dweck, & Markman, 2018, _Proc. CogSci_.)

```{r, fig.width = 3, fig.asp = 1.49}
d_46 %>%
  mean_cent_fun("character", age_group = "children") %>%
  gather(character, mean_cent, -capacity) %>%
  mutate(character = factor(character, levels = character_names_ch)) %>%
  ggplot(aes(y = capacity, x = character, fill = mean_cent)) +
  geom_tile(color = "black") +
  scale_fill_gradient(low = "black", high = "white", # limits = c(-2, 2),
                      guide = guide_colorbar(barheight = 15)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) +
  labs(title = "Raw data: 4- to 6-year-old children",
       subtitle = "9 characters, 20 capacities",
       y = "Capacity",
       x = "Character",
       fill = "Mean rating")
```


## SVD {.tabset}

### Adults

```{r}
svd4_ad <- svd(d_ad %>% 
                 mean_cent_fun("character", age_group = "adults") %>%
                 column_to_rownames("capacity"),
               nrow(d_ad), nrow(d_ad))
```

#### Reconstructed data

```{r, fig.width = 3, fig.asp = 1.49}
plot_reconstruct_fun(svd4_ad, transpose = TRUE, "adults") +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_U_fun(svd4_ad, "adults", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd4_ad) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1}
plot_V_fun(svd4_ad, "adults", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd4_ad, "adults", transpose = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "V: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd4_ad, "adults", transpose = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "V: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd4_ad, "adults", transpose = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "V: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd4_ad, "adults", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "U: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd4_ad, "adults", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "U: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd4_ad, "adults", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Adults (Approach #4)",
       subtitle = "U: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 7-9y

```{r}
svd4_79 <- svd(d_79 %>% 
                 mean_cent_fun("character", age_group = "children") %>%
                 column_to_rownames("capacity"),
               nrow(d_79), nrow(d_79))
```

#### Reconstructed data

```{r, fig.width = 3, fig.asp = 1.49}
plot_reconstruct_fun(svd4_79, transpose = TRUE, "children") +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_U_fun(svd4_79, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd4_79) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1}
plot_V_fun(svd4_79, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd4_79, "children", transpose = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "V: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd4_79, "children", transpose = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "V: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd4_79, "children", transpose = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "V: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd4_79, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "U: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd4_79, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "U: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd4_79, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 7-9y (Approach #4)",
       subtitle = "U: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-6y

```{r}
svd4_46 <- svd(d_46 %>% 
                 mean_cent_fun("character", age_group = "children") %>%
                 column_to_rownames("capacity"),
               nrow(d_46), nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 3, fig.asp = 1.49}
plot_reconstruct_fun(svd4_46, transpose = TRUE, "children") +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_U_fun(svd4_46, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd4_46) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1}
plot_V_fun(svd4_46, "children", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd4_46, "children", transpose = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "V: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_V_fun_item(svd4_46, "children", transpose = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "V: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_V_fun_item(svd4_46, "children", transpose = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "V: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd4_46, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "U: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd4_46, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "U: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd4_46, "children", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-6y (Approach #4)",
       subtitle = "U: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


### Children, 4-9y

```{r}
svd4_49 <- svd(d_79 %>%
                 mutate(character = paste(character, "79", sep = "_")) %>%
                 bind_rows(d_46 %>%
                             mutate(character = paste(character, "46", 
                                                      sep = "_"))) %>% 
                 mean_cent_fun("character", age_group = "children") %>%
                 column_to_rownames("capacity"), 
               nrow(d_79) + nrow(d_46), nrow(d_79) + nrow(d_46))
```

#### Reconstructed data

```{r, fig.width = 4, fig.asp = 0.67}
plot_reconstruct_fun(svd4_49, transpose = TRUE, "children_comb") +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "Reconstructed dataset: Sum of outer products (U, V) multiplied by S",
       x = "", y = "")
```

#### Feature vectors

```{r, fig.width = 3, fig.asp = 1}
plot_U_fun(svd4_49, "children_comb", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "U: Feature vectors (by mode)",
       # subtitle = "U x S: Feature vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Singular values

```{r, fig.width = 3, fig.asp = 1}
plot_S_fun(svd4_49) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "S: Singular values (by mode)",
       x = "", y = "")
```

#### Item vectors

```{r, fig.width = 3, fig.asp = 1.49}
plot_V_fun(svd4_49, "children_comb", transpose = TRUE, multiply = FALSE) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "V: Item vectors (by mode)",
       # subtitle = "V x S: Item vectors multiplied by singular value (by mode)",
       x = "", y = "")
```

#### Plotting in dimensions

```{r, fig.width = 4, fig.asp = 1}
plot_V_fun_item(svd4_49, "children_comb", transpose = TRUE, 
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "V: Capacities in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_V_fun_item(svd4_49, "children_comb", transpose = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "V: Capacities in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))

plot_V_fun_item(svd4_49, "children_comb", transpose = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "V: Capacities in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3") +
  scale_color_manual(guide = "none",
                     values = c(rep("black", 9), rep("dodgerblue", 9)))
```

```{r, fig.width = 4, fig.asp = 1}
plot_U_fun_prop(svd4_49, "children_comb", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_02")) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "U: Characters in Modes 1 & 2",
       x = "Mode 1", y = "Mode 2")

plot_U_fun_prop(svd4_49, "children_comb", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_01", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "U: Characters in Modes 1 & 3",
       x = "Mode 1", y = "Mode 3")

plot_U_fun_prop(svd4_49, "children_comb", transpose = TRUE, efa_colors = TRUE,
                modes = c("mode_02", "mode_03")) +
  labs(title = "SVD: Children, 4-9y (Approach #4)",
       subtitle = "U: Characters in Modes 2 & 3",
       x = "Mode 2", y = "Mode 3")
```


